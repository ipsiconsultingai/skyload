기능 명세서를 기반으로 최고 품질의 코드를 구현합니다.

## 핵심 원칙

1. **완벽한 자동화**: 명세서만으로 질문 없이 구현 가능해야 함
2. **품질 최우선**: 성능, 가독성, 확장성, 보안 모두 고려
3. **단계적 구현**: 우선순위(🔴→🟡→🟢) 순서로 구현
4. **기능 구현 집중**: 테스트와 문서화는 별도 명령어 사용

## 관련 명령어

| 명령어         | 용도             | 실행 시점    |
| -------------- | ---------------- | ------------ |
| `/spec`        | 기능 구현        | 먼저 실행    |
| `/create-jest` | 테스트 코드 작성 | 기능 구현 후 |
| `/w-context`   | CONTEXT.md 작성  | 기능 구현 후 |

## 실행 방법

```bash
/spec                   # specs/ 디렉토리 목록 표시
/spec {파일명}          # specs/{파일명}.md 기반 구현
/spec user-auth         # specs/user-auth.md 구현
```

---

## 실행 프로세스

### Phase 0: 명세서 로드

```bash
# 인자가 없으면 목록 출력 후 종료
ls specs/
```

```bash
# 인자가 있으면 명세서 읽기
cat specs/$ARGUMENTS.md
```

파일이 없으면 에러 메시지 출력 후 종료:

```
❌ specs/$ARGUMENTS.md 파일을 찾을 수 없습니다.
사용 가능한 명세서: [목록]
```

---

### Phase 1: 명세서 분석 및 이해

#### 1.1 전체 구조 파악

명세서의 각 섹션을 분석하고 내부적으로 정리합니다:

| 섹션            | 추출할 정보                             |
| --------------- | --------------------------------------- |
| 개요            | 기능의 목적, 해결하려는 문제            |
| 사용자 시나리오 | 구현해야 할 플로우                      |
| 기능 요구사항   | 🔴 필수 → 🟡 권장 → 🟢 선택 순으로 정렬 |
| 구현 위치       | 생성/수정할 파일 경로                   |
| 기존 코드 활용  | import할 모듈, 참고할 패턴              |
| 타입 정의       | 구현할 인터페이스/타입                  |
| API 설계        | 엔드포인트, 요청/응답 스펙              |
| 컴포넌트 설계   | Props, 상태 관리 방식                   |
| 에러 처리       | 에러 코드, 메시지, 처리 방법            |
| 테스트 시나리오 | 작성할 테스트 케이스                    |
| 성공 기준       | 완료 판단 기준                          |

#### 1.2 CONTEXT.md 참조

명세서의 "기존 코드 활용"에 명시된 모듈의 CONTEXT.md를 읽어 설계 의도와 사용 패턴을 파악합니다:

```bash
# 예: libs/fetch 활용 시
cat libs/fetch/CONTEXT.md
```

#### 1.3 기존 코드 패턴 분석

필요시 기존 코드를 직접 분석하여 프로젝트의 패턴과 컨벤션을 파악합니다.

---

### Phase 2: 구현 전 검토 (질문 결정)

#### 2.1 명세서 완성도 체크

다음 항목이 명세서에 **명확히** 정의되어 있는지 확인합니다:

| 체크 항목 | 필요 정보                                  |
| --------- | ------------------------------------------ |
| 구현 위치 | 파일 경로가 명시되어 있는가?               |
| 타입 정의 | 인터페이스/타입이 정의되어 있는가?         |
| 에러 처리 | 에러 케이스와 처리 방법이 있는가?          |
| 상태 관리 | 서버/클라이언트 구분이 있는가? (UI의 경우) |

#### 2.2 질문 결정 기준

**질문이 필요한 경우** (반드시 사용자에게 확인):

- 구현 위치가 불명확하거나 여러 선택지가 있는 경우
- 기존 코드와 충돌이 예상되는 경우
- 명세서에 없는 중요한 기술적 결정이 필요한 경우
- 보안/성능에 큰 영향을 미치는 트레이드오프가 있는 경우

**질문 없이 진행하는 경우**:

- 명세서가 충분히 상세한 경우
- CLAUDE.md 컨벤션으로 자연스럽게 결정되는 경우
- 업계 표준 베스트 프랙티스가 명확한 경우

#### 2.3 질문 형식 (필요시)

```markdown
## 구현 전 확인이 필요합니다

명세서 분석 결과, 다음 사항에 대한 결정이 필요합니다:

### 1. [질문 제목]

**상황**: [현재 상황 설명]
**선택지**:

- A: [옵션 A] - 장점/단점
- B: [옵션 B] - 장점/단점

**권장**: [권장 옵션과 이유]

---

위 사항을 확인해주시면 구현을 진행하겠습니다.
```

---

### Phase 3: 구현 계획 수립

#### 3.1 Todo 리스트 생성

명세서의 요구사항을 기반으로 TodoWrite를 사용하여 작업 목록을 생성합니다:

```
우선순위 순서:
1. 🔴 필수 요구사항 (모두 완료해야 함)
2. 🟡 권장 요구사항 (시간이 허락하면)
3. 🟢 선택 요구사항 (추가 개선)
```

#### 3.2 구현 순서 결정

의존성을 고려하여 구현 순서를 결정합니다:

```
1. 타입 정의 (types.ts)
   ↓
2. 에러 클래스 (errors.ts) - 필요시
   ↓
3. 핵심 로직 (core.ts)
   ↓
4. 유틸리티 함수 - 필요시
   ↓
5. API 라우트 (app/api/...) - 필요시
   ↓
6. UI 컴포넌트 - 필요시
   ↓
7. 페이지 통합 - 필요시
   ↓
8. index.ts (export)
```

> **참고**: 테스트(`/create-jest`)와 문서화(`/w-context`)는 기능 구현 완료 후 별도로 실행합니다.

#### 3.3 파일 생성 계획

명세서의 "구현 위치"를 기반으로 생성/수정할 파일 목록을 정리합니다:

```markdown
### 생성할 파일

- `libs/모듈명/types.ts` - 타입 정의
- `libs/모듈명/core.ts` - 핵심 로직
- `libs/모듈명/index.ts` - export

### 수정할 파일

- `기존파일.ts` - 변경 내용
```

---

### Phase 4: 코드 구현

#### 4.1 타입 정의 우선

명세서의 "타입 정의" 섹션을 기반으로 types.ts를 먼저 작성합니다:

```typescript
// 명세서에 정의된 타입을 그대로 구현
// Zod 스키마도 함께 정의 (런타임 검증용)
```

#### 4.2 에러 클래스 (필요시)

명세서의 "에러 처리" 섹션을 기반으로 에러 클래스를 작성합니다:

```typescript
// 에러 코드, 메시지를 명세서 그대로 구현
// 프로젝트의 기존 에러 패턴 참고 (libs/services/oauth/errors.ts)
```

#### 4.3 핵심 로직 구현

**구현 원칙**:

1. **CLAUDE.md 컨벤션 준수**
   - 네이밍 규칙 (camelCase 함수, PascalCase 타입)
   - 화살표 함수 선호
   - 조기 반환 패턴
   - import 순서

2. **성능 고려**
   - 불필요한 연산 최소화
   - 메모이제이션 적용 (React 컴포넌트의 경우)
   - 번들 크기 고려 (dynamic import)

3. **가독성 고려**
   - 함수는 한 가지 일만 (단일 책임)
   - 명확한 변수/함수명
   - 복잡한 로직에 주석

4. **확장성 고려**
   - 인터페이스 기반 설계
   - 하드코딩 지양
   - 설정 분리

5. **보안 고려**
   - 입력값 Zod 검증
   - 민감 정보 노출 방지

#### 4.4 API 라우트 구현 (해당시)

명세서의 "API 설계" 섹션을 기반으로 구현:

```typescript
// Next.js App Router 패턴
// 요청/응답 예시 그대로 구현
// 에러 응답 형식 통일
```

#### 4.5 UI 컴포넌트 구현 (해당시)

명세서의 "컴포넌트 설계" 섹션을 기반으로 구현:

```typescript
// 서버/클라이언트 구분 ("use client" 필요시)
// Props 인터페이스 그대로 구현
// 상태 관리 방식 준수
// 인터랙션 (로딩, 에러, 성공) 구현
```

#### 4.6 에러 처리 구현

명세서의 "에러 처리" 테이블을 기반으로 모든 에러 케이스를 처리:

```typescript
// 에러 상황 → 에러 코드 → 사용자 메시지 → 처리 방법
// 테이블의 모든 케이스를 코드로 구현
```

---

### Phase 5: 검증

#### 5.1 타입 체크

```bash
pnpm build
```

에러 발생 시 수정 후 재시도.

#### 5.2 린트 체크

```bash
pnpm lint
```

에러 발생 시 수정 후 재시도.

#### 5.3 성공 기준 확인

명세서의 "성공 기준 > 완료 조건" 중 기능 관련 항목 체크:

```markdown
- [x] 모든 기능 요구사항(🔴) 구현
- [x] 타입 체크 통과
- [x] 린트 통과
- [x] 에러 케이스 처리 완료
```

---

### Phase 6: 완료 보고

#### 6.1 출력 형식

```markdown
## ✅ 구현 완료: {기능명}

### 요약

> {명세서의 한 줄 요약}

### 구현된 요구사항

- [x] 🔴 요구사항 1
- [x] 🔴 요구사항 2
- [x] 🟡 요구사항 3

### 생성된 파일

| 파일               | 설명           |
| ------------------ | -------------- |
| `path/to/types.ts` | 타입 정의      |
| `path/to/core.ts`  | 핵심 로직      |
| `path/to/index.ts` | Public exports |

### 수정된 파일

| 파일                  | 변경 내용   |
| --------------------- | ----------- |
| `path/to/existing.ts` | [변경 설명] |

### 검증 결과

| 항목      | 결과    |
| --------- | ------- |
| 타입 체크 | ✅ 통과 |
| 린트      | ✅ 통과 |

### 사용 예시

\`\`\`typescript
// 기본 사용법
import { ... } from "@/libs/모듈명";

// 예시 코드
\`\`\`

### 다음 단계

\`\`\`bash
/create-jest # 테스트 코드 작성
/w-context # CONTEXT.md 작성
\`\`\`

### 미구현 요구사항 (해당시)

- [ ] 🟡 권장 요구사항
- [ ] 🟢 선택 요구사항
```

---

## 구현 단계가 있는 경우 (Phase 1/2/3)

명세서에 "구현 단계" 섹션이 있는 경우:

1. **Phase 1 (MVP)만 먼저 구현**
2. 완료 보고에 다음 Phase 안내
3. 사용자가 다음 Phase 요청 시 계속 진행

```markdown
### 현재 진행 상황

- ✅ Phase 1: MVP 완료
- ⏳ Phase 2: 개선 (대기 중)
- ⏳ Phase 3: 고도화 (대기 중)

Phase 2를 진행하려면 `/spec {파일명}` 을 다시 실행해주세요.
```

---

## 품질 체크리스트

구현 완료 전 최종 확인:

### 코드 품질

- [ ] CLAUDE.md 컨벤션 준수
- [ ] TypeScript strict 모드 에러 없음
- [ ] 불필요한 any 타입 없음
- [ ] 적절한 에러 처리
- [ ] 입력값 검증 (Zod)

### 성능

- [ ] 불필요한 연산 없음
- [ ] 메모이제이션 적용 (필요시)
- [ ] 번들 크기 고려

---

## 에러 상황 대응

### 명세서 파일 없음

```
❌ specs/$ARGUMENTS.md 파일을 찾을 수 없습니다.

사용 가능한 명세서:
- specs/user-auth.md
- specs/link-management.md

템플릿: specs/_template.md
```

### 명세서 불완전

```
⚠️ 명세서에 필수 정보가 누락되었습니다:

누락된 섹션:
- [ ] 구현 위치
- [ ] 타입 정의

specs/_template.md를 참고하여 명세서를 보완해주세요.
```

### 빌드/테스트 실패

```
❌ 검증 실패

실패 항목: [타입 체크 | 린트 | 테스트]
에러 내용: [에러 메시지]

수정 후 재시도합니다...
```
